import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
data = {
    "í–‰ì •êµ¬ì—­ë³„": [
        "ì „êµ­", "ì„œìš¸íŠ¹ë³„ì‹œ", "ë¶€ì‚°ê´‘ì—­ì‹œ", "ëŒ€êµ¬ê´‘ì—­ì‹œ", "ì¸ì²œê´‘ì—­ì‹œ", "ê´‘ì£¼ê´‘ì—­ì‹œ",
        "ëŒ€ì „ê´‘ì—­ì‹œ", "ìš¸ì‚°ê´‘ì—­ì‹œ", "ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ", "ê²½ê¸°ë„", "ê°•ì›íŠ¹ë³„ìì¹˜ë„",
        "ì¶©ì²­ë¶ë„", "ì¶©ì²­ë‚¨ë„", "ì „ë¶íŠ¹ë³„ìì¹˜ë„", "ì „ë¼ë‚¨ë„", "ê²½ìƒë¶ë„",
        "ê²½ìƒë‚¨ë„", "ì œì£¼íŠ¹ë³„ìì¹˜ë„"
    ],
    "ê³ ë ¹ì¸êµ¬ë¹„ìœ¨ (%)": [
        18.6, 18.3, 22.4, 19.4, 16.4, 16.3, 16.6, 15.7, 10.5, 15.4,
        23.4, 19.9, 20.1, 23.4, 25.4, 23.8, 20.0, 17.5
    ],
    "65ì„¸ì´ìƒì¸êµ¬ (ëª…)": [
        9608981, 1714624, 733701, 462548, 495272, 237330,
        244415, 173398, 40741, 2122758,
        357924, 326972, 446264, 413812, 450865,
        615461, 654605, 118291
    ],
    "ì „ì²´ì¸êµ¬ (ëª…)": [
        51774521, 9384512, 3279604, 2379188, 3025950,
        1457090, 1470336, 1107432, 386261,
        13815367, 1528014, 1641481,
        2216332, 1768491, 1776668,
        2589880, 3271148, 676767
    ]
}

df = pd.DataFrame(data)

# Streamlit ì•± êµ¬ì„±
st.title('ğŸš€ í•œêµ­ ì‚¬íšŒ: ì‹¤ë²„ SHOCKì— ëŒ€ë¹„í•˜ë¼! ğŸš€')
st.write(
    """
    í•œêµ­ì€ ë¹ ë¥´ê²Œ ë‹¤ê°€ì˜¤ëŠ” ê³ ë ¹í™” ì‹œëŒ€ì˜ í•œê°€ìš´ë°ì— ìˆìŠµë‹ˆë‹¤.
    ì¶œì‚°ìœ¨ì€ ë‚®ì•„ì§€ê³  ì—°ë¡œí•œ ì¸êµ¬ëŠ” ì¦ê°€í•˜ëŠ” ì´ ë³µì¡í•œ ì—¬ì • ì†ì—ì„œ,
    ìš°ë¦¬ëŠ” ì–´ë–¤ ë¯¸ë˜ë¥¼ ë§Œë“¤ì–´ ë‚˜ê°€ì•¼ í• ê¹Œìš”?
    """
)

# ì—¬ë°± ì¶”ê°€ë¥¼ ìœ„í•´ ë¹ˆ ì¤„ ì‚½ì…
st.text("\n")

st.subheader("ğŸ“Š í–‰ì •êµ¬ì—­ë³„ ê³ ë ¹í™” ë°ì´í„°")
st.dataframe(df)

# ì—¬ë°± ì¶”ê°€
st.text("\n")

st.subheader("ğŸ” ì£¼ìš” í†µê³„")
total_population = df["ì „ì²´ì¸êµ¬ (ëª…)"].sum()
elderly_population = df["65ì„¸ì´ìƒì¸êµ¬ (ëª…)"].sum()
elderly_ratio = (elderly_population / total_population) * 100

st.write(f"**ì „êµ­ ì´ ì¸êµ¬:** {total_population:,}ëª…")
st.write(f"**ì „êµ­ ê³ ë ¹ ì¸êµ¬:** {elderly_population:,}ëª…")
st.write(f"**ì „êµ­ ê³ ë ¹ ì¸êµ¬ ë¹„ìœ¨:** {elderly_ratio:.2f}%")

# ì—¬ë°± ì¶”ê°€
st.text("\n")

# ê³ ë ¹í™” ë¹„ìœ¨ ìƒìœ„ ì§€ì—­ í•„í„°ë§
st.subheader("ğŸ† ê³ ë ¹í™” ë¹„ìœ¨ ìƒìœ„ ì§€ì—­")
top_elderly_regions = df.nlargest(5, "ê³ ë ¹ì¸êµ¬ë¹„ìœ¨ (%)")[["í–‰ì •êµ¬ì—­ë³„", "ê³ ë ¹ì¸êµ¬ë¹„ìœ¨ (%)"]]
st.table(top_elderly_regions)

# ì—¬ë°± ì¶”ê°€
st.text("\n")

# ì‚¬ìš©ì ì…ë ¥: íŠ¹ì • ì§€ì—­ ê²€ìƒ‰
st.subheader("ğŸ” íŠ¹ì • ì§€ì—­ ì •ë³´ ê²€ìƒ‰")
selected_region = st.selectbox("ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”:", df["í–‰ì •êµ¬ì—­ë³„"])
region_data = df[df["í–‰ì •êµ¬ì—­ë³„"] == selected_region]

if not region_data.empty:
    st.write(f"**{selected_region}ì˜ ê³ ë ¹í™” ë°ì´í„°:**")
    st.write(region_data)

# ì—¬ë°± ì¶”ê°€
st.text("\n")

# ë§‰ëŒ€ê·¸ë˜í”„ ì‹œê°í™” (Seabornìœ¼ë¡œ ìƒ‰ìƒ ê°œì„ )
st.subheader("ğŸ“Š í–‰ì •êµ¬ì—­ë³„ ê³ ë ¹í™” ë¹„ìœ¨ ë¹„êµ")
fig, ax = plt.subplots(figsize=(12, 7))
sns.barplot(
    x="í–‰ì •êµ¬ì—­ë³„",
    y="ê³ ë ¹ì¸êµ¬ë¹„ìœ¨ (%)",
    data=df,
    palette="coolwarm",
    ax=ax
)
ax.set_title("í–‰ì •êµ¬ì—­ë³„ ê³ ë ¹ì¸êµ¬ë¹„ìœ¨ (%)", fontsize=16)
ax.set_xlabel("í–‰ì •êµ¬ì—­", fontsize=12)
ax.set_ylabel("ê³ ë ¹ì¸êµ¬ë¹„ìœ¨ (%)", fontsize=12)
plt.xticks(rotation=45)
st.pyplot(fig)
